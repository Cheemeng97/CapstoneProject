import paramiko

macList = ["01:23:45:67:89:aa", "01:23:45:67:89:bb"]

commands = [
    'config rule',
	'option src "lan"',
	'option dest "wan"',
	'option proto "tcp"',
	'option family "ipv4"',
	'option dest_ip "<ChatGPT IP address>"',
	'option dest_port "80 443"',
	'option target "REJECT"',
	'option name "REJECT-LAN-CHATGPT"',
	'option enabled "1"',
]

commitFirewall = 'uci commit firewall'
restartFirewall = '/etc/init.d/firewall restart'

# Establish SSH connection
ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ssh.connect('192.168.3.1', username='root', password='Qsfhk!xdr1')

for macAddress in macList:
    
    for command in commands:
        stdin, stdout, stderr = ssh.exec_command(command)
        macAddressCommand = f'uci set firewall.@rule[-1].src_mac="{macAddress}"'
        stdin, stdout, stderr = ssh.exec_command(macAddressCommand)
        output = stdout.read().decode()
        error = stderr.read().decode()
        if output:
            print(output)
        if error:
            print(error)

stdin, stdout, stderr = ssh.exec_command(commitFirewall)
output = stdout.read().decode()
error = stderr.read().decode()
if output:
    print(output)
if error:
    print(error)

stdin, stdout, stderr = ssh.exec_command(restartFirewall)
output = stdout.read().decode()
error = stderr.read().decode()
if output:
    print(output)
if error:
    print(error)

# close SSH connection
ssh.close()
